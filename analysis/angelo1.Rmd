---
title: "angelo1"
author: "StephanLewandowsky"
date: "2019-09-24"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

## Introduction

The analyses are available at https://stephanlewandowsky.github.io/angelo/. 

```{r echo=FALSE, warning=FALSE, message=FALSE, results="hide"}
rm(list=ls())
library(lattice)
library(stargazer)
library(tidyverse)
library(lme4)
library(lavaan)
library(semPlot)
library(semTools)
library(RColorBrewer)
library(gridExtra)
library(stringr)
library(Hmisc)
library(reshape2)
library(psych)
library(scales)
library(summarytools) #contains descr()
library(workflowr)

revscore <- function (x,cluster) {  #this reverse scores a scale for items of reversed polarity
  return ((likscaleupper[cluster]+1)-x)            
}

#define working directories
inputdir <- "data"

##--- Begin by reading data and variable names -----------------------------------------------------------------------
angelo1 <- read.csv(paste(inputdir,"Study 1 - Data Matrix (Complete).csv",sep="/"),header=TRUE,row.names=NULL) 
```

## Summary statistics
```{r summary, echo=FALSE}
table(angelo1$Sex)
prop.table(table(angelo1$Sex))

descr(angelo1$Age)

table(angelo1$Education)
prop.table(table(angelo1$Education))

descr(select(angelo1,starts_with("Polit")))

itemclusters <- c("R.PBS", "IAS.R.PBS", "GCBS", "IAS.GCBS", "PSEUDO", "IAS.PSEUDO")
```

## Participants who pressed the same key for all items in a cluster (0: no cluster, >=1: number of clusters)
```{r keyhitters, echo=FALSE}
# identify keyhitters before reverse-scoring
neutral <- 0 #if set to zero, any sequence of identical keys is eliminated. If set to 4, only non-neutral responses are dropped
keyhitters <- NULL
for (cluster in itemclusters) {
   keyhitters <- cbind(keyhitters, angelo1 %>% select(starts_with(cluster)) %>% 
                      apply(.,1,FUN=function(x) ifelse((var(x)==0 & mean(x)!=neutral),1,0)) )
 }
table(rowSums(keyhitters))


#do reverse scoring
likscaleupper <- c(7,4,5,4,5,4)
names(likscaleupper) <- itemclusters
angelo2 <- select(angelo1,1:6) #grab first bit, then add columns
for (cluster in itemclusters) {
   angelo2 <- cbind(angelo2, angelo1 %>% select(starts_with(cluster)) %>% mutate_at(vars(contains("..R")),revscore,cluster)) 
}
angelo2 <- cbind(angelo2,angelo1$SIN.B)
```

```{r corrs, echo=FALSE, results="hide"}
# compute pairwise correlations within each cluster
for (cluster in itemclusters) {
  angelo2 %>% select(starts_with(cluster)) %>% cor(use="complete.obs") %>% print
}

```

## Correlations among composites
```{r composites, echo=FALSE}

angelocomps <- NULL
for (cluster in itemclusters) {
    angelocomps <- cbind(angelocomps, angelo2 %>% select(starts_with(cluster)) %>% apply(.,1,mean,na.rm=TRUE))
}
angelocomps <- as.data.frame(angelocomps)
names(angelocomps) <- itemclusters
angelocomps <- cbind(select(angelo1,1:6), angelocomps)

cor(angelocomps %>% select(-c(1:6)))

```  
